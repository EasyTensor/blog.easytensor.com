<!doctype html><html lang=en-us><head><title>Pytorch Support - EasyTensor Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel=stylesheet><link rel=stylesheet href=https://blog.easytensor.com/css/bootstrap.css><link rel=stylesheet href=https://blog.easytensor.com/css/custom.css><link rel=icon href=/images/favicon.ico type=image/x-icon></head><body><main id=main><div class=container><div class="row justify-content-center text-center my-5"><div class=col-lg-10><h1 class="mb-4 text-center">Pytorch Support</h1><p class="small mb-5 text-center"><span class=text-uppercase>April 4, 2021</span></p></div></div></div><div class="bg-skew bg-skew-light"><div class=container><div class="row justify-content-center"><div class=col-lg-8><article class=pb-2><p>We&rsquo;ve been working on this one for a while, so I&rsquo;m pretty excited to share that we&rsquo;re finally adding support for PyTorch models!</p><p><strong>Decision Hell</strong></p><p>This project took about 3x longer than anticipated because PyTorch has so many <a href=https://pytorch.org/tutorials/intermediate/flask_rest_api_tutorial.html>different ways</a> of exporting a model, that we had to make multiple decisions that heavily influenced EasyTensor&rsquo;s interface to the engineer. The most difficult one was deciding on whether to adopt <a href=https://github.com/pytorch/serve>Pytorch Serve</a> (PyTorch&rsquo;s own serving framework) or implement our own model server for PyTorch. It turns out PyTorch Serve is still very buggy (still in beta), something that we only found out about after integrating it fully in our stack ðŸ’¢. At the end of the day, the risk for supporting an in-development framework was not worth it, so we decided to create our own simple framework built on top of FastAPI.</p><p>Another decision came in designing the inference interface (that&rsquo;s a mouthful). Since PyTorch models do not have a standardized inference function that takes in a predictable number of arguments, we decided to allow the engineer to define their own inference functions, which then meant hosting the engineer&rsquo;s code on EasyTensor. This can be a pandora box, so we&rsquo;re starting small and constraining the engineer&rsquo;s python code to only have one file that can have a maximum of one class (the model definition) and must include a <code>predict_single</code> function. The nice thing here is that the engineer is fully in control of the pre-processing, inference, and post-processing of the user&rsquo;s raw input.</p><p><strong>How it works</strong></p><p>PyTorch models are exported in two steps:</p><ol><li>The model&rsquo;s weights and biases</li><li>The model&rsquo;s class definition</li></ol><p>The first one is rather simple, and pytorch exposes utility functions to take care of it. EasyTensor will automatically export the model weights as part of the upload step.</p><p>The second is more challenging because it puts the onus of correctly defining the model class on the engineer. PyTorch and EasyTensor can offer very little help. Naturally, we developed an interface.</p><p>The engineer must create a class definition in a python file and include a <code>predict_single</code> inference function that the serve will call on every inference request. This means the engineer has all the freedom to instantiate the class and define the inference function (which also means they get to control what the input looks like).</p><p><strong>How to use it</strong></p><ol><li>Copy your model&rsquo;s class definition to a file called <code>model.py</code>. Make sure the file:<ul><li>Only has one class definition, which is your model</li><li>The class definition takes no arguments</li><li>The class definition has a <code>predict_single</code> method that will accept your user&rsquo;s input, run inference, and return the output.</li></ul></li></ol><ul><li>load/train your model on a python interpreter and call</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>
<span style=color:#f92672>import</span> easytensor; easytensor<span style=color:#f92672>.</span>pytorch<span style=color:#f92672>.</span>upload(<span style=color:#e6db74>&#34;My first PyTorch model&#34;</span>, model, <span style=color:#e6db74>&#34;model.py&#34;</span>)

</code></pre></div><p class="mt-5 text-center"></p></article><div class="row pt-5 pb-5"><div class="col-6 text-left"></div><div class="col-6 text-right"><a class=text-reset href=https://blog.easytensor.com/posts/newsletter-05-04-2021/>Newsletter 05-04-2021 &rarr;</a></div></div></div></div></div></div></main><footer class="site-footer mt-5"><div class=container><div class="row justify-content-md-between"><div class="col-sm-12 col-md-4 mb-4"><h2 class="h5 mb-3">EasyTensor Blog</h2><p>EasyTensor Blog</p></div><div class="col-4 col-md-2 mb-4"><h2 class="h5 mb-3">Menu</h2><ul class="nav flex-column"><li class=mb-1><a href=https://blog.easytensor.com/ class=text-secondary>Home</a></li><li class=mb-1><a href=/about/ class=text-secondary>About</a></li></ul></div></div><hr><div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-center"><div class="text-muted mb-3">Â© 2021 copyright EasyTensor
<a href=https://10mohi6.tk class=text-reset>design</a> <a href=https://github.com/10mohi6/hugo-theme-simple-blog class=text-reset>theme</a></p></div></div></div></footer></body></html>